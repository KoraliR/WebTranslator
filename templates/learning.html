{% extends "start.html" %}

{% block title %}Игра по переводу слов{% endblock %}

{% block content %}
<div class="game-container">
    <div class="word-field" id="word-field"></div>
    <div class="options-field" id="options-field"></div>
</div>

<div class="score-container">
    <div class="score" id="correct">Верно: 0</div>
    <div class="score" id="incorrect">Неверно: 0</div>
    <div class="score" id="skipped">Пропущено: 0</div>
    <button class="next-button" onclick="nextWord()">Далее</button>
    <button class="exit-button" onclick="exitGame()">Выход</button>
</div>

<div id="end-message" style="display:none; margin-top:20px; font-size:24px; color:var(--text-color); text-align:center;">
    Все слова пройдены! Отличная работа!
</div>

<script>
    let wordList = {{ words|tojson }};
    let currentWordIndex = 0;
    let correctCount = 0;
    let incorrectCount = 0;
    let skippedCount = 0;
    let userAnswered = false;

    function loadWord() {
        const current = wordList[currentWordIndex];
        if (!current) {
            document.getElementById('end-message').style.display = 'block';
            document.getElementById('word-field').style.display = 'none';
            document.getElementById('options-field').style.display = 'none';
            document.querySelector('.next-button').style.display = 'none';
            return;
        }

        userAnswered = false;

        document.getElementById('word-field').textContent = current.word;

        const optionsField = document.getElementById('options-field');
        optionsField.innerHTML = '';

        current.options.forEach(optionText => {
            const option = document.createElement('div');
            option.className = 'option';
            option.textContent = optionText;
            option.onclick = () => checkAnswer(option, current.correct_translation);
            optionsField.appendChild(option);
        });
    }

    function checkAnswer(option, correctTranslation) {
        if (userAnswered) return;

        if (option.textContent === correctTranslation) {
            option.classList.add('correct');
            correctCount++;
        } else {
            option.classList.add('incorrect');
            const options = document.querySelectorAll('.option');
            options.forEach(opt => {
                if (opt.textContent === correctTranslation) {
                    opt.classList.add('correct');
                }
            });
            incorrectCount++;
        }

        updateScore();
        userAnswered = true;
    }

    function nextWord() {
        if (!userAnswered) {
            skippedCount++;
            updateScore();
        }

        currentWordIndex++;
        loadWord();
    }

    function updateScore() {
        document.getElementById('correct').textContent = `Верно: ${correctCount}`;
        document.getElementById('incorrect').textContent = `Неверно: ${incorrectCount}`;
        document.getElementById('skipped').textContent = `Пропущено: ${skippedCount}`;
    }

    function exitGame() {
        window.location.href = '/';
    }

    loadWord();
</script>

<style>
    .game-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin: 20px 0;
    }

    .word-field {
        width: 400px;
        height: 200px;
        background-color: var(--card-bg, #f0f0f0);
        border: 1px solid #ccc;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        color: var(--text-color, #333);
    }

    .options-field {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .option {
        width: 400px;
        height: 60px;
        background-color: var(--card-bg, #f0f0f0);
        border: 1px solid #ccc;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
        color: var(--text-color, #333);
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .option.correct {
        background-color: #4caf50;
        color: #fff;
    }

    .option.incorrect {
        background-color: #f44336;
        color: #fff;
    }

    .score-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .score {
        font-size: 18px;
    }

    #correct {
        color: #4caf50;
    }

    #incorrect {
        color: #f44336;
    }

    #skipped {
        color: gray;
    }

    .next-button,
    .exit-button {
        padding: 10px 20px;
        background-color: #007bff; /* Синий фон */
        color: #ffffff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
    }

    .next-button:hover,
    .exit-button:hover {
        background-color: #0056b3; /* Более темно-синий */
        color: #ffffff;
    }
</style>
{% endblock %}
